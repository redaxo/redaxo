#!/usr/bin/env bash

# refreshes the redaxo installation.
# most of the time this is required when working on the REDAXO sources after checking out a Pull Request via GitHub.com

cp -R redaxo/src/core/assets/* assets/core/
php -r 'foreach (require "redaxo/src/core/vendor_files.php" as $src => $dst) { $dst = "assets/core/" . $dst; @mkdir(dirname($dst), 0775, true); copy("redaxo/src/core/assets_files/" . $src, $dst); }'

if [ "true" = $(redaxo/bin/console config:get setup) ]; then
    redaxo/bin/console cache:clear --ansi

    echo "Core/Addons can not be re-installed, because the REDAXO setup is not done yet."

    exit
fi

.tools/bin/reinstall-core

packages="
debug
install
users
"

for package in $packages; do
    if redaxo/bin/console addon:list --package $package --installed-only --error-when-empty --quiet; then
        redaxo/bin/console addon:install --ansi --re-install $package
    fi
done

redaxo/bin/console cache:clear --ansi

composer update --ansi # update dev-tools
