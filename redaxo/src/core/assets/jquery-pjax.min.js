(function(b){function J(a,d,e){var c=this;return this.on("click.pjax",a,function(a){var f=b.extend({},l(d,e));f.container||(f.container=b(this).attr("data-pjax")||c);A(a,f)})}function A(a,d,e){e=l(d,e);d=a.currentTarget;if("A"!==d.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||location.protocol!==d.protocol||location.hostname!==d.hostname||-1<d.href.indexOf("#")&&d.href.replace(/#.*/,"")==location.href.replace(/#.*/,
"")||a.isDefaultPrevented())){var c={url:d.href,container:b(d).attr("data-pjax"),target:d};e=b.extend({},c,e);c=b.Event("pjax:click");b(d).trigger(c,[e]);c.isDefaultPrevented()||(f(e),a.preventDefault(),b(d).trigger("pjax:clicked",[e]))}}function K(a,d,e){e=l(d,e);d=a.currentTarget;var c=b(d);if("FORM"!==d.tagName.toUpperCase())throw"$.pjax.submit requires a form element";c={type:(c.attr("method")||"GET").toUpperCase(),url:c.attr("action"),container:c.attr("data-pjax"),target:d};if("GET"!==c.type&&
void 0!==window.FormData)c.data=new FormData(d),c.processData=!1,c.contentType=!1;else{if(b(d).find(":file").length)return;c.data=b(d).serializeArray()}f(b.extend({},c,e));a.preventDefault()}function f(a){function d(a,d,c){c||(c={});c.relatedTarget=e;a=b.Event(a,c);h.trigger(a,d);return!a.isDefaultPrevented()}a=b.extend(!0,{},b.ajaxSettings,f.defaults,a);b.isFunction(a.url)&&(a.url=a.url());var e=a.target,c=t(a.url).hash,h=a.context=B(a.container);a.data||(a.data={});b.isArray(a.data)?a.data.push({name:"_pjax",
value:h.selector}):a.data._pjax=h.selector;var k;a.beforeSend=function(b,e){"GET"!==e.type&&(e.timeout=0);b.setRequestHeader("X-PJAX","true");b.setRequestHeader("X-PJAX-Container",h.selector);if(!d("pjax:beforeSend",[b,e]))return!1;0<e.timeout&&(k=setTimeout(function(){d("pjax:timeout",[b,a])&&b.abort("timeout")},e.timeout),e.timeout=0);var f=t(e.url);c&&(f.hash=c);a.requestUrl=C(f)};a.complete=function(b,c){k&&clearTimeout(k);d("pjax:complete",[b,c,a]);d("pjax:end",[b,a])};a.error=function(b,c,e){var f=
D("",b,a);b=d("pjax:error",[b,c,e,a]);"GET"==a.type&&"abort"!==c&&b&&u(f.url)};a.success=function(e,m,k){var n=f.state,p="function"===typeof b.pjax.defaults.version?b.pjax.defaults.version():b.pjax.defaults.version,l=k.getResponseHeader("X-PJAX-Version"),g=D(e,k,a),q=t(g.url);c&&(q.hash=c,g.url=q.href);if(p&&l&&p!==l)u(g.url);else if(g.contents){f.state={id:a.id||(new Date).getTime(),url:g.url,title:g.title,container:h.selector,fragment:a.fragment,timeout:a.timeout};(a.push||a.replace)&&window.history.replaceState(f.state,
g.title,g.url);if(b.contains(a.container,document.activeElement))try{document.activeElement.blur()}catch(r){}g.title&&(document.title=g.title);d("pjax:beforeReplace",[g.contents,a],{state:f.state,previousState:n});h.html(g.contents);(n=h.find("input[autofocus], textarea[autofocus]").last()[0])&&document.activeElement!==n&&n.focus();L(g.scripts);g=a.scrollTo;c&&(n=decodeURIComponent(c.slice(1)),n=document.getElementById(n)||document.getElementsByName(n)[0])&&(g=b(n).offset().top);"number"==typeof g&&
b(window).scrollTop(g);d("pjax:success",[e,m,k,a])}else u(g.url)};f.state||(f.state={id:(new Date).getTime(),url:window.location.href,title:document.title,container:h.selector,fragment:a.fragment,timeout:a.timeout},window.history.replaceState(f.state,document.title));E(f.xhr);f.options=a;var m=f.xhr=b.ajax(a);0<m.readyState&&(a.push&&!a.replace&&(M(f.state.id,F(h)),window.history.pushState(null,"",a.requestUrl)),d("pjax:start",[m,a]),d("pjax:send",[m,a]));return f.xhr}function N(a,d){return f(b.extend({url:window.location.href,
push:!1,replace:!0,scrollTo:!1},l(a,d)))}function u(a){window.history.replaceState(null,"",f.state.url);window.location.replace(a)}function G(a){q||E(f.xhr);var d=f.state,e=a.state,c;if(e&&e.container){if(q&&O==e.url)return;if(d){if(d.id===e.id)return;c=d.id<e.id?"forward":"back"}var h=p[e.id]||[];a=b(h[0]||e.container);h=h[1];if(a.length){if(d){var k=c,m=d.id,l=F(a);p[m]=l;"forward"===k?(k=r,l=v):(k=v,l=r);k.push(m);(m=l.pop())&&delete p[m];w(k,f.defaults.maxCacheLength)}c=b.Event("pjax:popstate",
{state:e,direction:c});a.trigger(c);c={id:e.id,url:e.url,container:a,push:!1,fragment:e.fragment,timeout:e.timeout,scrollTo:!1};h?(a.trigger("pjax:start",[null,c]),f.state=e,e.title&&(document.title=e.title),d=b.Event("pjax:beforeReplace",{state:e,previousState:d}),a.trigger(d,[h,c]),a.html(h),a.trigger("pjax:end",[null,c])):f(c);a[0].offsetHeight}else u(location.href)}q=!1}function P(a){var d=b.isFunction(a.url)?a.url():a.url,e=a.type?a.type.toUpperCase():"GET",c=b("<form>",{method:"GET"===e?"GET":
"POST",action:d,style:"display:none"});"GET"!==e&&"POST"!==e&&c.append(b("<input>",{type:"hidden",name:"_method",value:e.toLowerCase()}));a=a.data;if("string"===typeof a)b.each(a.split("&"),function(a,d){var e=d.split("=");c.append(b("<input>",{type:"hidden",name:e[0],value:e[1]}))});else if(b.isArray(a))b.each(a,function(a,d){c.append(b("<input>",{type:"hidden",name:d.name,value:d.value}))});else if("object"===typeof a)for(var f in a)c.append(b("<input>",{type:"hidden",name:f,value:a[f]}));b(document.body).append(c);
c.submit()}function E(a){a&&4>a.readyState&&(a.onreadystatechange=b.noop,a.abort())}function F(a){var b=a.clone();b.find("script").each(function(){this.src||jQuery._data(this,"globalEval",!1)});return[a.selector,b.contents()]}function C(a){a.search=a.search.replace(/([?&])(_pjax|_)=[^&]*/g,"");return a.href.replace(/\?($|#)/,"$1")}function t(a){var b=document.createElement("a");b.href=a;return b}function l(a,d){a&&d?d.container=a:d=b.isPlainObject(a)?a:{container:a};d.container&&(d.container=B(d.container));
return d}function B(a){a=b(a);if(a.length){if(""!==a.selector&&a.context===document)return a;if(a.attr("id"))return b("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}function x(a,b){return a.filter(b).add(a.find(b))}function y(a){return b.parseHTML(a,document,!0)}function D(a,d,e){var c={},f=/<html/i.test(a);d=d.getResponseHeader("X-PJAX-URL");c.url=d?C(t(d)):e.requestUrl;f?(d=b(y(a.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0])),a=b(y(a.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))):
d=a=b(y(a));if(0===a.length)return c;c.title=x(d,"title").last().text();e.fragment?(f="body"===e.fragment?a:x(a,e.fragment).first(),f.length&&(c.contents="body"===e.fragment?f:f.contents(),c.title||(c.title=f.attr("title")||f.data("title")))):f||(c.contents=a);c.contents&&(c.contents=c.contents.not(function(){return b(this).is("title")}),c.contents.find("title").remove(),c.scripts=x(c.contents,"script[src]").remove(),c.contents=c.contents.not(c.scripts));c.title&&(c.title=b.trim(c.title));return c}
function L(a){if(a){var d=b("script[src]");a.each(function(){var a=this.src;if(!d.filter(function(){return this.src===a}).length){var c=document.createElement("script"),f=b(this).attr("type");f&&(c.type=f);c.src=b(this).attr("src");document.head.appendChild(c)}})}}function M(a,b){p[a]=b;r.push(a);w(v,0);w(r,f.defaults.maxCacheLength)}function w(a,b){for(;a.length>b;)delete p[a.shift()]}function Q(){return b("meta").filter(function(){var a=b(this).attr("http-equiv");return a&&"X-PJAX-VERSION"===a.toUpperCase()}).attr("content")}
function H(){b.fn.pjax=J;b.pjax=f;b.pjax.enable=b.noop;b.pjax.disable=I;b.pjax.click=A;b.pjax.submit=K;b.pjax.reload=N;b.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:Q};b(window).on("popstate.pjax",G)}function I(){b.fn.pjax=function(){return this};b.pjax=P;b.pjax.enable=H;b.pjax.disable=b.noop;b.pjax.click=b.noop;b.pjax.submit=b.noop;b.pjax.reload=function(){window.location.reload()};b(window).off("popstate.pjax",G)}var q=!0,O=window.location.href,
z=window.history.state;z&&z.container&&(f.state=z);"state"in window.history&&(q=!1);var p={},v=[],r=[];0>b.inArray("state",b.event.props)&&b.event.props.push("state");b.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);b.support.pjax?H():I()})(jQuery);
