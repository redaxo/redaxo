(function(b){function D(a,c,e){var d=this;return this.on("click.pjax",a,function(a){var f=b.extend({},l(c,e));f.container||(f.container=b(this).attr("data-pjax")||d);v(a,f)})}function v(a,c,e){e=l(c,e);c=a.currentTarget;if("A"!==c.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey))if(!(location.protocol!==c.protocol||location.host!==c.host)&&!(c.hash&&c.href.replace(c.hash,"")===location.href.replace(location.hash,
""))&&c.href!==location.href+"#")c={url:c.href,container:b(c).attr("data-pjax"),target:c,fragment:null},f(b.extend({},c,e)),a.preventDefault()}function E(a,c,e){e=l(c,e);c=a.currentTarget;if("FORM"!==c.tagName.toUpperCase())throw"$.pjax.submit requires a form element";c={type:c.method.toUpperCase(),url:c.action,data:b(c).serializeArray(),container:b(c).attr("data-pjax"),target:c,fragment:null};f(b.extend({},c,e));a.preventDefault()}function f(a){function c(a,c){var d=b.Event(a,{relatedTarget:e});
j.trigger(d,c);return!d.isDefaultPrevented()}a=b.extend(!0,{},b.ajaxSettings,f.defaults,a);b.isFunction(a.url)&&(a.url=a.url());var e=a.target,d=t(a.url).hash,j=a.context=w(a.container);a.data||(a.data={});a.data._pjax=j.selector;var k;a.beforeSend=function(b,d){"GET"!==d.type&&(d.timeout=0);b.setRequestHeader("X-PJAX","true");b.setRequestHeader("X-PJAX-Container",j.selector);if(!c("pjax:beforeSend",[b,d]))return!1;0<d.timeout&&(k=setTimeout(function(){c("pjax:timeout",[b,a])&&b.abort("timeout")},
d.timeout),d.timeout=0);a.requestUrl=t(d.url).href};a.complete=function(b,d){k&&clearTimeout(k);c("pjax:complete",[b,d,a]);c("pjax:end",[b,a])};a.error=function(b,d,e){var f=x("",b,a);b=c("pjax:error",[b,d,e,a]);"GET"==a.type&&("abort"!==d&&b)&&r(f.url)};a.success=function(e,h,k){var m="function"===typeof b.pjax.defaults.version?b.pjax.defaults.version():b.pjax.defaults.version,l=k.getResponseHeader("X-PJAX-Version"),g=x(e,k,a);if(m&&l&&m!==l)r(g.url);else if(g.contents){f.state={id:a.id||(new Date).getTime(),
url:g.url,title:g.title,container:j.selector,fragment:a.fragment,timeout:a.timeout};(a.push||a.replace)&&window.history.replaceState(f.state,g.title,g.url);g.title&&(document.title=g.title);j.html(g.contents);if(m=g.scripts){var n=b("script[src]");m.each(function(){var a=this.src;if(!n.filter(function(){return this.src===a}).length){var c=document.createElement("script");c.type=b(this).attr("type");c.src=b(this).attr("src");document.head.appendChild(c)}})}"number"===typeof a.scrollTo&&b(window).scrollTop(a.scrollTo);
(a.replace||a.push)&&window._gaq&&_gaq.push(["_trackPageview"]);""!==d&&(m=t(g.url),m.hash=d,f.state.url=m.href,window.history.replaceState(f.state,g.title,m.href),g=b(m.hash),g.length&&b(window).scrollTop(g.offset().top));c("pjax:success",[e,h,k,a])}else r(g.url)};f.state||(f.state={id:(new Date).getTime(),url:window.location.href,title:document.title,container:j.selector,fragment:a.fragment,timeout:a.timeout},window.history.replaceState(f.state,document.title));var h=f.xhr;h&&4>h.readyState&&(h.onreadystatechange=
b.noop,h.abort());f.options=a;h=f.xhr=b.ajax(a);if(0<h.readyState){if(a.push&&!a.replace){var l=f.state.id,q=j.clone().contents();n[l]=q;for(p.push(l);s.length;)delete n[s.shift()];for(;p.length>f.defaults.maxCacheLength;)delete n[p.shift()];window.history.pushState(null,"",y(a.requestUrl))}c("pjax:start",[h,a]);c("pjax:send",[h,a])}return f.xhr}function F(a,c){return f(b.extend({url:window.location.href,push:!1,replace:!0,scrollTo:!1},l(a,c)))}function r(a){window.history.replaceState(null,"","#");
window.location.replace(a)}function z(a){if((a=a.state)&&a.container){if(A&&G==a.url)return;var c=b(a.container);if(c.length){var e,d=n[a.id];if(f.state){var j=e=f.state.id<a.id?"forward":"back",k=f.state.id,h=c.clone().contents();n[k]=h;"forward"===j?(j=p,h=s):(j=s,h=p);j.push(k);(k=h.pop())&&delete n[k]}e=b.Event("pjax:popstate",{state:a,direction:e});c.trigger(e);e={id:a.id,url:a.url,container:c,push:!1,fragment:a.fragment,timeout:a.timeout,scrollTo:!1};d?(c.trigger("pjax:start",[null,e]),a.title&&
(document.title=a.title),c.html(d),f.state=a,c.trigger("pjax:end",[null,e])):f(e);c[0].offsetHeight}else r(location.href)}A=!1}function H(a){var c=b.isFunction(a.url)?a.url():a.url,e=a.type?a.type.toUpperCase():"GET",d=b("<form>",{method:"GET"===e?"GET":"POST",action:c,style:"display:none"});"GET"!==e&&"POST"!==e&&d.append(b("<input>",{type:"hidden",name:"_method",value:e.toLowerCase()}));a=a.data;if("string"===typeof a)b.each(a.split("&"),function(a,c){var e=c.split("=");d.append(b("<input>",{type:"hidden",
name:e[0],value:e[1]}))});else if("object"===typeof a)for(key in a)d.append(b("<input>",{type:"hidden",name:key,value:a[key]}));b(document.body).append(d);d.submit()}function y(a){return a.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function t(a){var b=document.createElement("a");b.href=a;return b}function l(a,c){a&&c?c.container=a:c=b.isPlainObject(a)?a:{container:a};c.container&&(c.container=w(c.container));return c}function w(a){a=b(a);if(a.length){if(""!==a.selector&&
a.context===document)return a;if(a.attr("id"))return b("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}function q(a){return b.parseHTML(a,document,!0)}function x(a,c,e){var d={};d.url=y(c.getResponseHeader("X-PJAX-URL")||e.requestUrl);if(/<html/i.test(a)){c=b(q(a.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var f=b(q(a.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else c=f=b(q(a));if(0===f.length)return d;d.title=c.filter("title").add(c.find("title")).last().text();
e.fragment?(a="body"===e.fragment?f:f.filter(e.fragment).add(f.find(e.fragment)).first(),a.length&&(d.contents=a.contents(),d.title||(d.title=a.attr("title")||a.data("title")))):/<html/i.test(a)||(d.contents=f);d.contents&&(d.contents=d.contents.not(function(){return b(this).is("title")}),d.contents.find("title").remove(),d.scripts=d.contents.filter("script[src]").add(d.contents.find("script[src]")).remove(),d.contents=d.contents.not(d.scripts));d.title&&(d.title=b.trim(d.title));return d}function I(){return b("meta").filter(function(){var a=
b(this).attr("http-equiv");return a&&"X-PJAX-VERSION"===a.toUpperCase()}).attr("content")}function B(){b.fn.pjax=D;b.pjax=f;b.pjax.enable=b.noop;b.pjax.disable=C;b.pjax.click=v;b.pjax.submit=E;b.pjax.reload=F;b.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:I};b(window).bind("popstate.pjax",z)}function C(){b.fn.pjax=function(){return this};b.pjax=H;b.pjax.enable=B;b.pjax.disable=b.noop;b.pjax.click=b.noop;b.pjax.submit=b.noop;b.pjax.reload=
function(){window.location.reload()};b(window).unbind("popstate.pjax",z)}var A=!0,G=window.location.href,u=window.history.state;u&&u.container&&(f.state=u);var n={},s=[],p=[];0>b.inArray("state",b.event.props)&&b.event.props.push("state");b.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);b.support.pjax?B():C()})(jQuery);
