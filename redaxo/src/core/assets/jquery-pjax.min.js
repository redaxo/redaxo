(function(b){function A(a,c,f){var d=this;return this.on("click.pjax",a,function(a){var e=b.extend({},k(c,f));e.container||(e.container=b(this).attr("data-pjax")||d);t(a,e)})}function t(a,c,f){f=k(c,f);c=a.currentTarget;if("A"!==c.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey))if(!(location.protocol!==c.protocol||location.host!==c.host)&&!(c.hash&&c.href.replace(c.hash,"")===location.href.replace(location.hash,
""))&&c.href!==location.href+"#")c={url:c.href,container:b(c).attr("data-pjax"),target:c,fragment:null},e(b.extend({},c,f)),a.preventDefault()}function B(a,c,f){f=k(c,f);c=a.currentTarget;if("FORM"!==c.tagName.toUpperCase())throw"$.pjax.submit requires a form element";c={type:c.method,url:c.action,data:b(c).serializeArray(),container:b(c).attr("data-pjax"),target:c,fragment:null};e(b.extend({},c,f));a.preventDefault()}function e(a){function c(a,c){var d=b.Event(a,{relatedTarget:f});g.trigger(d,c);
return!d.isDefaultPrevented()}a=b.extend(!0,{},b.ajaxSettings,e.defaults,a);b.isFunction(a.url)&&(a.url=a.url());var f=a.target,d=r(a.url).hash,g=a.context=u(a.container);a.data||(a.data={});a.data._pjax=g.selector;var l;a.beforeSend=function(b,d){"GET"!==d.type&&(d.timeout=0);b.setRequestHeader("X-PJAX","true");b.setRequestHeader("X-PJAX-Container",g.selector);if(!c("pjax:beforeSend",[b,d]))return!1;0<d.timeout&&(l=setTimeout(function(){c("pjax:timeout",[b,a])&&b.abort("timeout")},d.timeout),d.timeout=
0);a.requestUrl=r(d.url).href};a.complete=function(b,d){l&&clearTimeout(l);c("pjax:complete",[b,d,a]);c("pjax:end",[b,a])};a.error=function(b,d,e){var f=v("",b,a);b=c("pjax:error",[b,d,e,a]);"GET"==a.type&&("abort"!==d&&b)&&s(f.url)};a.success=function(f,j,l){var h=v(f,l,a);if(h.contents){e.state={id:a.id||(new Date).getTime(),url:h.url,title:h.title,container:g.selector,fragment:a.fragment,timeout:a.timeout};(a.push||a.replace)&&window.history.replaceState(e.state,h.title,h.url);h.title&&(document.title=
h.title);g.html(h.contents);"number"===typeof a.scrollTo&&b(window).scrollTop(a.scrollTo);(a.replace||a.push)&&window._gaq&&_gaq.push(["_trackPageview"]);if(""!==d){var k=r(h.url);k.hash=d;e.state.url=k.href;window.history.replaceState(e.state,h.title,k.href);h=b(k.hash);h.length&&b(window).scrollTop(h.offset().top)}c("pjax:success",[f,j,l,a])}else s(h.url)};e.state||(e.state={id:(new Date).getTime(),url:window.location.href,title:document.title,container:g.selector,fragment:a.fragment,timeout:a.timeout},
window.history.replaceState(e.state,document.title));var j=e.xhr;j&&4>j.readyState&&(j.onreadystatechange=b.noop,j.abort());e.options=a;j=e.xhr=b.ajax(a);if(0<j.readyState){if(a.push&&!a.replace){var k=e.state.id,p=g.clone().contents();m[k]=p;for(n.push(k);q.length;)delete m[q.shift()];for(;n.length>e.defaults.maxCacheLength;)delete m[n.shift()];window.history.pushState(null,"",w(a.requestUrl))}c("pjax:start",[j,a]);c("pjax:send",[j,a])}return e.xhr}function C(a,c){return e(b.extend({url:window.location.href,
push:!1,replace:!0,scrollTo:!1},k(a,c)))}function s(a){window.history.replaceState(null,"","#");window.location.replace(a)}function x(a){if((a=a.state)&&a.container){var c=b(a.container);if(c.length){var f=m[a.id];if(e.state){var d=e.state.id<a.id?"forward":"back",g=e.state.id,l=c.clone().contents(),j;m[g]=l;"forward"===d?(l=n,j=q):(l=q,j=n);l.push(g);(g=j.pop())&&delete m[g];d=b.Event("pjax:popstate",{state:a,direction:d});c.trigger(d);d={id:a.id,url:a.url,container:c,push:!1,fragment:a.fragment,
timeout:a.timeout,scrollTo:!1};f?(c.trigger("pjax:start",[null,d]),a.title&&(document.title=a.title),c.html(f),e.state=a,c.trigger("pjax:end",[null,d])):e(d);c[0].offsetHeight}else e.state=a}else s(location.href)}}function D(a){var c=b.isFunction(a.url)?a.url():a.url,e=a.type?a.type.toUpperCase():"GET",d=b("<form>",{method:"GET"===e?"GET":"POST",action:c,style:"display:none"});"GET"!==e&&"POST"!==e&&d.append(b("<input>",{type:"hidden",name:"_method",value:e.toLowerCase()}));a=a.data;if("string"===
typeof a)b.each(a.split("&"),function(a,c){var e=c.split("=");d.append(b("<input>",{type:"hidden",name:e[0],value:e[1]}))});else if("object"===typeof a)for(key in a)d.append(b("<input>",{type:"hidden",name:key,value:a[key]}));b(document.body).append(d);d.submit()}function w(a){return a.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function r(a){var b=document.createElement("a");b.href=a;return b}function k(a,c){a&&c?c.container=a:c=b.isPlainObject(a)?a:{container:a};
c.container&&(c.container=u(c.container));return c}function u(a){a=b(a);if(a.length){if(""!==a.selector&&a.context===document)return a;if(a.attr("id"))return b("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}function p(a){return b.parseHTML(a,document,!0)}function v(a,c,e){var d={};d.url=w(c.getResponseHeader("X-PJAX-URL")||e.requestUrl);if(/<html/i.test(a)){c=b(p(a.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var g=b(p(a.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else c=
g=b(p(a));if(0===g.length)return d;d.title=c.filter("title").add(c.find("title")).last().text();e.fragment?(a="body"===e.fragment?g:g.filter(e.fragment).add(g.find(e.fragment)).first(),a.length&&(d.contents=a.contents(),d.title||(d.title=a.attr("title")||a.data("title")))):/<html/i.test(a)||(d.contents=g);d.contents&&(d.contents=d.contents.not("title"),d.contents.find("title").remove());d.title&&(d.title=b.trim(d.title));return d}function y(){b.fn.pjax=A;b.pjax=e;b.pjax.enable=b.noop;b.pjax.disable=
z;b.pjax.click=t;b.pjax.submit=B;b.pjax.reload=C;b.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20};b(window).bind("popstate.pjax",x)}function z(){b.fn.pjax=function(){return this};b.pjax=D;b.pjax.enable=y;b.pjax.disable=b.noop;b.pjax.click=b.noop;b.pjax.submit=b.noop;b.pjax.reload=function(){window.location.reload()};b(window).unbind("popstate.pjax",x)}var m={},q=[],n=[];0>b.inArray("state",b.event.props)&&b.event.props.push("state");b.support.pjax=
window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);b.support.pjax?y():z()})(jQuery);
