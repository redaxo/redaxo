#!/usr/bin/env php
<?php

unset($REX);
$REX['REDAXO'] = true;
$REX['HTDOCS_PATH'] = '../';
$REX['BACKEND_FOLDER'] = 'redaxo';

chdir(dirname(__DIR__));

// Check if posix is available
if (!function_exists('posix_getuid')) {
        echo "REDAXO console". PHP_EOL;
        echo "-----------------------------------------------" . PHP_EOL;
		echo "The posix extensions are required - see http://php.net/manual/en/book.posix.php" . PHP_EOL;
		exit(1);
	}
// Check current user
	$currentuser = posix_getpwuid(posix_getuid());
	$webuser = posix_getpwuid(fileowner($REX['HTDOCS_PATH'].$REX['BACKEND_FOLDER']));
	if ($currentuser['name'] !== $webuser['name']) {
        echo "REDAXO console". PHP_EOL;
		echo "Please run console with the user that owns the folder /redaxo" . PHP_EOL;
        echo "-----------------------------------------------" . PHP_EOL;
		echo "Current user: " . $currentuser['name'] . PHP_EOL;
        echo "-----------------------------------------------" . PHP_EOL;
		echo "Owner of redaxo: " . $webuser['name'] . PHP_EOL;
        echo "-----------------------------------------------" . PHP_EOL;
		echo "Try to run console by adding 'sudo -u " . $webuser['name'] . " ' to the beginning of the command" . PHP_EOL;
		echo "If running with 'docker exec' try adding the option '-u " . $webuser['name'] . "' to the docker command" . PHP_EOL;
		exit(1);
	}

require __DIR__.'/../src/core/console.php';

